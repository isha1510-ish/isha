<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- MindAR aur A-Frame ki scripts include kar rahe hain -->
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.0.0/dist/mindar-image.prod.js"></script>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.0.0/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
</head>
<body>
  <!-- A-Frame scene setup -->
  <a-scene mindar-image="imageTargetSrc: ./targets.mind;" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights">
    <a-assets>
      <!-- ID card image ko assets mein load kar rahe hain -->
      <img id="idcard-image" src="./idcard.jpg.jpeg" crossorigin="anonymous">
    </a-assets>

    <!-- Camera setup -->
    <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="far: 10000; objects: .clickable"></a-camera>

    <!-- ID card target setup -->
    <a-entity id="idcard-target" mindar-image-target="targetIndex: 0">
      <!-- Information display ke liye plane -->
      <a-plane id="info-plane" position="0 0 0" rotation="0 0 0" width="1.5" height="1" color="#FFF"></a-plane>
    </a-entity>
  </a-scene>

  <script type="text/javascript">
    const idCardTarget = document.querySelector('#idcard-target');
    const infoPlane = document.querySelector('#info-plane');

    // Jab ID card target milta hai
    idCardTarget.addEventListener("targetFound", event => {
      console.log("ID card target found");
      extractTextFromImage(); // Text extract karne ka function call kar rahe hain
    });

    // Jab ID card target chala jata hai
    idCardTarget.addEventListener("targetLost", event => {
      console.log("ID card target lost");
      infoPlane.setAttribute('visible', false); // Information plane ko hide kar rahe hain
    });

    // Function jo image se text extract karega
    async function extractTextFromImage() {
      const image = document.getElementById('idcard-image');
      const result = await Tesseract.recognize(image, 'eng', { logger: m => console.log(m) }); // Tesseract.js use karke text extract kar rahe hain
      console.log(result.data.text);
      displayInformation(result.data.text); // Extracted text ko display karne ka function call kar rahe hain
    }

    // Function jo extracted information display karega
    function displayInformation(text) {
      const info = text.split("\n").map(line => `<tspan x="0" dy="1.2em">${line}</tspan>`).join('');
      const svgText = `<svg xmlns="http://www.w3.org/2000/svg" width="1.5" height="1"><text x="0" y="0" font-size="0.1">${info}</text></svg>`;
      const blob = new Blob([svgText], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      infoPlane.setAttribute('material', `src: url(${url})`);
      infoPlane.setAttribute('visible', true); // Information plane ko visible kar rahe hain
    }
  </script>
</body>
</html>
